version: "3.6"
networks:
    {{DEV_NAMESPACE}}:
        name: {{DEV_NAMESPACE}}_default
services:
    nginx_main:
        networks:
            - {{DEV_NAMESPACE}}
        build:
            args:
                NGINX_VERSION: ${NGINX_VERSION}
            context: "${DEV_SUITE_BASE}/build/nginx"
        volumes:
            - "./scripts:/scripts"
            - "./etc/nginx:/etc/nginx/conf.d"
            - "./etc/ssl:/etc/ssl"
            - "${WWW_DIR}:/var/www"
            - "${NGINX_LOG_DIR}:/var/log/nginx"
        ports:
            - "${NGINX_HTTP_EXPOSING_PORT}:80"
            - "${NGINX_HTTPS_EXPOSING_PORT}:443"
        environment:
            NGINX_HOST:
    php72_primary:
        networks:
            - {{DEV_NAMESPACE}}
        build:
            context: "${DEV_SUITE_BASE}/build/php72"
        volumes:
            - "${WWW_DIR}:/var/www"
        environment:
            - PHP_UPLOAD_MAX_FILEZISE
            - PHP_POST_MAX_SIZE
            - PHP_MEMORY_LIMIT
            - PHP_MAX_EXECUTION_TIME
            - PHP_MAX_INPUT_TIME
    php72_secondary:
        networks:
            - {{DEV_NAMESPACE}}
        build:
            context: "${DEV_SUITE_BASE}/build/php72"
        volumes:
            - "${WWW2_DIR}:/var/www"
        environment:
            - PHP_UPLOAD_MAX_FILEZISE
            - PHP_POST_MAX_SIZE
            - PHP_MEMORY_LIMIT
            - PHP_MAX_EXECUTION_TIME
            - PHP_MAX_INPUT_TIME
    mysql_master:
        build:
            context: "${DEV_SUITE_BASE}/build/mysql57"
        container_name: {{DEV_NAMESPACE}}_mysql_master
        networks:
            - {{DEV_NAMESPACE}}
        environment:
            - MYSQL_DATABASE=${MYSQL_MASTER_DATABASE}
            - MYSQL_ROOT_PASSWORD=${MYSQL_MASTER_ROOT_PASSWORD}
            - MYSQL_USER=${MYSQL_MASTER_USER}
            - MYSQL_PASSWORD=${MYSQL_MASTER_PASSWORD}
        ports:
            - "${MYSQL_MASTER_EXPOSING_PORT}:3306"
    mysql_slave:
        build:
            context: "${DEV_SUITE_BASE}/build/mysql57"
        container_name: {{DEV_NAMESPACE}}_mysql_slave
        networks:
            - {{DEV_NAMESPACE}}
        environment:
            - MYSQL_DATABASE=${MYSQL_SLAVE_DATABASE}
            - MYSQL_ROOT_PASSWORD=${MYSQL_SLAVE_ROOT_PASSWORD}
            - MYSQL_USER=${MYSQL_SLAVE_USER}
            - MYSQL_PASSWORD=${MYSQL_SLAVE_PASSWORD}
        ports:
            - "${MYSQL_SLAVE_EXPOSING_PORT}:3306"
        depends_on:
            - mysql_master
    phpmyadmin:
        build:
            context: "./build/phpmyadmin"
        container_name: {{DEV_NAMESPACE}}_phpmyadmin
        ports:
            - "${PHPMYADMIN_WEB_EXPOSING_PORT}:80"
        environment:
            - PMA_ARBITRARY=1
